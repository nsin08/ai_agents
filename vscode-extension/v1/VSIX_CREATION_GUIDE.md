# VSCode Plugin .vsix File Creation Guide

This document provides step-by-step instructions for creating a .vsix (Visual Studio Code Extension Package) file for the VSCode plugin. A .vsix file is the distributable package format for VSCode extensions.

---

## Overview

A .vsix file is a compressed archive (ZIP format) containing:
- Extension source code and compiled assets
- package.json manifest with metadata
- README.md and CHANGELOG.md
- Extension icon
- All dependencies declared in package.json

**Purpose**: Ready for distribution via VS Code Marketplace or local installation.

---

## Pre-Packaging Checklist

Before creating the .vsix file, verify the following prerequisites:

### 1. package.json Validation

Ensure all required fields are present and correct:

```json
{
  "name": "your-extension-name",           // lowercase, no spaces
  "version": "1.0.0",                      // semantic versioning
  "publisher": "your-publisher-name",      // your publisher ID
  "displayName": "Your Extension Name",    // human-readable name
  "description": "What your extension does",
  "engines": {
    "vscode": "^1.70.0"                    // minimum VS Code version
  },
  "icon": "icon.png",                      // path to icon
  "license": "MIT",                        // license type
  "repository": {
    "type": "git",
    "url": "https://github.com/yourname/repo"
  },
  "contributes": {
    // contribution points (commands, views, etc.)
  }
}
```

**Checklist:**
- [ ] `name` field is lowercase with no spaces
- [ ] `version` follows semantic versioning (MAJOR.MINOR.PATCH)
- [ ] `publisher` field is set and matches your marketplace publisher ID
- [ ] `displayName` is human-readable
- [ ] `engines.vscode` specifies minimum version
- [ ] `icon` points to valid 128x128 PNG file
- [ ] `license` field is set

### 2. Essential Files

Verify the following files exist in your project root:

```
your-extension/
├── package.json              ✓ Required
├── tsconfig.json            ✓ Required (if using TypeScript)
├── README.md                ✓ Required
├── CHANGELOG.md             ✓ Required
├── LICENSE                  ✓ Required (MIT, Apache 2.0, etc.)
├── icon.png                 ✓ Required (128x128 pixels)
├── src/
│   ├── extension.ts         ✓ Required
│   └── ...
├── dist/ or out/            ✓ Compiled output (generated)
└── node_modules/            ✓ Generated by npm install
```

**Checklist:**
- [ ] README.md exists and contains complete documentation
- [ ] CHANGELOG.md exists with version history
- [ ] LICENSE file exists (MIT recommended)
- [ ] icon.png exists (128x128 PNG format, <4MB)
- [ ] package.json is complete and valid JSON

### 3. Code Quality Verification

Run the following validation commands:

```bash
# Navigate to project directory
cd vscode-extension/v1

# Install dependencies
npm install

# Compile TypeScript
npm run compile

# Run tests (if available)
npm test

# Check for linting issues
npm run lint

# Audit dependencies for vulnerabilities
npm audit
```

**Checklist:**
- [ ] `npm install` completes without errors
- [ ] `npm run compile` produces no errors
- [ ] All tests pass (if test suite exists)
- [ ] No linting errors (if linter configured)
- [ ] `npm audit` shows no critical vulnerabilities

### 4. Git Status (Optional but Recommended)

Ensure your code is committed:

```bash
git status
# Should show clean working directory
```

**Checklist:**
- [ ] All source files are committed to git
- [ ] No uncommitted changes in critical files

---

## Phase 1: Install Packaging Tool

### Option A: Global Installation (Recommended)

```bash
npm install -g @vscode/vsce
```

Verify installation:
```bash
vsce --version
# Output: vsce {version}
```

### Option B: Local Installation

```bash
npm install --save-dev @vscode/vsce
```

Then use:
```bash
npx vsce package
```

---

## Phase 2: Verify Configuration

### 2.1 Check package.json One More Time

```bash
# From your project directory
cat package.json | findstr "name\|version\|publisher\|displayName"
```

Expected output:
```
"name": "your-extension-name",
"version": "1.0.0",
"publisher": "your-publisher-name",
"displayName": "Your Extension Name"
```

### 2.2 Verify Icon File

```bash
# Check if icon exists and get file size
dir icon.png
# Should show: icon.png (size < 4 MB recommended)
```

### 2.3 Verify Compiled Output

If using TypeScript, ensure compiled files exist:

```bash
# Check if dist or out directory exists with compiled files
dir dist\ 
# or
dir out\
```

---

## Phase 3: Create the .vsix File

### 3.1 Basic Package Command

```bash
vsce package
```

**What happens:**
1. Validates package.json and all required fields
2. Checks for missing files (README, CHANGELOG, LICENSE)
3. Bundles source code and assets
4. Creates compressed .vsix file
5. Names file: `{publisher}.{name}-{version}.vsix`

**Example output:**
```
Publishing 'mycompany.myplugin' v1.0.0...
 DONE  Packaged: mycompany.myplugin-1.0.0.vsix
```

### 3.2 Packaging with Custom Output Path

```bash
# Create vsix in specific directory
vsce package -o ./releases/

# Output: releases/mycompany.myplugin-1.0.0.vsix
```

### 3.3 Packaging with Version Override

```bash
# Create vsix with different version
vsce package --target-version 2.0.0

# Output: mycompany.myplugin-2.0.0.vsix
```

---

## Phase 4: Verify the Package

### 4.1 Check .vsix File Creation

```bash
# List created .vsix file
dir *.vsix

# Expected output:
# mycompany.myplugin-1.0.0.vsix  {size in KB}
```

### 4.2 Inspect .vsix Contents (Optional)

The .vsix file is a ZIP archive. To inspect contents:

```bash
# Rename to .zip temporarily
copy mycompany.myplugin-1.0.0.vsix mycompany.myplugin-1.0.0.zip

# Extract to examine contents
Expand-Archive -Path mycompany.myplugin-1.0.0.zip -DestinationPath ./vsix-contents

# View structure
tree /F vsix-contents

# Expected structure:
# vsix-contents/
# ├── extension/
# │   ├── package.json
# │   ├── README.md
# │   ├── icon.png
# │   ├── dist/
# │   └── ...
# └── [Content_Types].xml
```

### 4.3 Verify File Size

```bash
# Check .vsix file size
(Get-Item mycompany.myplugin-1.0.0.vsix).Length / 1MB

# Should be reasonable size:
# - Minimal extension: < 5 MB
# - Average extension: 5-20 MB
# - Large extension: 20-50 MB
# Note: Max recommended is 100 MB
```

---

## Phase 5: Test the Package Locally

### 5.1 Install Extension from .vsix File

**Option A: VS Code UI**
1. Open VS Code
2. Go to Extensions panel (Ctrl+Shift+X)
3. Click "..." menu in top-right
4. Select "Install from VSIX..."
5. Navigate to and select your .vsix file
6. VS Code will install and enable the extension

**Option B: Command Line**
```bash
code --install-extension ./mycompany.myplugin-1.0.0.vsix
```

### 5.2 Verify Extension Installation

After installation:
1. Check Extensions panel shows your extension
2. Check extension is marked as "Enabled"
3. Reload VS Code (Ctrl+Shift+P → "Developer: Reload Window")

### 5.3 Run Sanity Tests

Follow the tests in **SANITY_TESTS.md**:

```bash
# TEST 1: Chat Panel Basics
# TEST 2: Configuration Works
# TEST 3: Code Intelligence
# TEST 4: Multi-Agent Coordination
# TEST 5: Dashboard Rendering
# Automated tests: npm test
```

All tests should pass without errors.

### 5.4 Check Extension Output

```bash
# In VS Code, open the Extension Development Host output
1. Open Developer Tools (Ctrl+Shift+I)
2. Go to Console tab
3. Look for your extension logs
4. Verify no ERROR or WARNING messages
```

---

## Phase 6: Validation & Troubleshooting

### Common Issues & Solutions

#### Issue 1: "Missing or invalid publisher"
```
Error: Missing publisher in package.json
```

**Solution:**
```json
{
  "publisher": "your-publisher-id"  // Add this field
}
```

Ensure your publisher ID matches your VS Code Marketplace publisher account.

#### Issue 2: "Missing required files"
```
Error: Missing file: README.md
```

**Solution:**
- Create README.md in project root with full documentation
- Ensure LICENSE file exists
- Ensure icon.png exists (128x128 PNG)

#### Issue 3: "Invalid icon"
```
Error: Icon is not a valid image
```

**Solution:**
- Image must be PNG format
- Minimum size: 128x128 pixels
- Maximum size: 256x256 recommended
- File size: < 4 MB
- Test with: `file icon.png` or image viewer

#### Issue 4: ".vsix file too large"
```
Warning: Extension is larger than recommended 50 MB
```

**Solution:**
- Remove unnecessary dependencies
- Exclude large files from .vsix:
  ```json
  "files": [
    "dist",
    "README.md",
    "icon.png",
    "package.json"
  ]
  ```
- Use `.vscodeignore` to exclude files:
  ```
  .git
  .gitignore
  tests/
  **/*.test.ts
  **/*.spec.ts
  node_modules/
  ```

#### Issue 5: "Compilation errors during packaging"
```
Error: TypeScript compilation failed
```

**Solution:**
```bash
# Run compile step before packaging
npm run compile
# Fix any TypeScript errors
# Then try packaging again
vsce package
```

### Validation Checklist Before Publishing

- [ ] .vsix file created successfully (no errors)
- [ ] .vsix file size is reasonable (< 100 MB)
- [ ] Extension installs without errors
- [ ] SANITY_TESTS.md checks all pass
- [ ] No console errors in Extension Development Host
- [ ] All features work as expected
- [ ] README is clear and complete
- [ ] CHANGELOG documents the version
- [ ] No security vulnerabilities (npm audit)

---

## Phase 7: Distribution Options

### Option A: Local Distribution

Share the .vsix file directly:

```bash
# Via email, cloud storage, or file sharing
# User can install with:
code --install-extension ./mycompany.myplugin-1.0.0.vsix
```

**Pros**: Fast, no marketplace approval needed  
**Cons**: Manual distribution, no auto-updates

### Option B: VS Code Marketplace

Publish to official marketplace for auto-distribution:

```bash
# 1. Create/Login to publisher account at marketplace.visualstudio.com
# 2. Create Personal Access Token (PAT) in Azure DevOps
# 3. Login with vsce
vsce login your-publisher-name

# 4. Publish the extension
vsce publish

# 5. For subsequent versions, increment version in package.json
# and run publish again
```

### Option C: GitHub Releases

Attach .vsix to GitHub release:

```bash
# 1. Create release on GitHub
# 2. Attach .vsix file to release
# 3. Users download and install manually
```

---

## Workflow Summary: Quick Reference

```bash
# 1. Navigate to project
cd vscode-extension/v1

# 2. Verify code quality
npm install
npm run compile
npm test
npm run lint

# 3. Verify package.json and required files
# (README.md, CHANGELOG.md, LICENSE, icon.png)

# 4. Create .vsix file
vsce package

# 5. Verify .vsix file created
dir *.vsix

# 6. Test locally (optional)
code --install-extension ./mycompany.myplugin-1.0.0.vsix

# 7. Run SANITY_TESTS.md
# All tests should pass

# 8. Distribute or publish
# Option A: Share .vsix file
# Option B: vsce publish (if marketplace account exists)
```

---

## Automated Packaging Script (Optional)

Create a `scripts/package.sh` (Linux/Mac) or `scripts/package.bat` (Windows) for one-command packaging:

**Windows (package.bat):**
```batch
@echo off
echo Installing dependencies...
call npm install

echo Compiling TypeScript...
call npm run compile

echo Running tests...
call npm test

echo Creating .vsix file...
call vsce package

echo.
echo ✓ Packaging complete!
dir *.vsix
pause
```

**Usage:**
```bash
./scripts/package.bat
```

---

## Next Steps

After creating the .vsix file:

1. **For Local Use**: Share the .vsix file with team members
2. **For Marketplace**: Publish using `vsce publish` with marketplace account
3. **For Updates**: Update version in package.json, update CHANGELOG.md, then repeat packaging
4. **For Continuous Delivery**: Automate packaging in GitHub Actions

---

## References

- **VS Code Documentation**: https://code.visualstudio.com/api/working-with-extensions/publishing-extension
- **VSCE CLI**: https://github.com/microsoft/vscode-vsce
- **Marketplace Publisher Dashboard**: https://marketplace.visualstudio.com/manage
- **Personal Access Token Guide**: https://docs.microsoft.com/en-us/azure/devops/organizations/accounts/use-personal-access-tokens-to-authenticate

---

## Checklist: Ready to Package?

- [ ] package.json has all required fields (name, version, publisher, displayName, engines)
- [ ] README.md exists with complete documentation
- [ ] CHANGELOG.md exists with version history
- [ ] LICENSE file exists
- [ ] icon.png exists (128x128 PNG)
- [ ] npm install runs successfully
- [ ] npm run compile produces no errors
- [ ] npm test passes all tests
- [ ] No linting errors (npm run lint)
- [ ] npm audit shows no critical vulnerabilities
- [ ] All code is committed to git

**Once all items are checked, run:**
```bash
vsce package
```

