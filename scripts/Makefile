.PHONY: help setup run test lint format type-check clean install-all install-dev

SHELL := /bin/bash
VENV_DIR := .venv

help:
	@echo "Interactive Agent Playground - Make Commands"
	@echo "=============================================="
	@echo ""
	@echo "setup              - Set up environment with uv"
	@echo "run                - Run interactive agent"
	@echo "test               - Run tests"
	@echo "test-cov           - Run tests with coverage"
	@echo "lint               - Run ruff linter"
	@echo "lint-fix           - Fix linting issues"
	@echo "format             - Format code with black"
	@echo "type-check         - Run mypy type checking"
	@echo "check              - Run all checks (lint, format, type)"
	@echo "install-dev        - Install dev dependencies"
	@echo "install-ollama     - Install Ollama support"
	@echo "install-all        - Install all dependencies"
	@echo "clean              - Remove virtual environment and cache"
	@echo "clean-cache        - Remove only cache files"
	@echo ""

setup:
	@if [ -d "$(VENV_DIR)" ]; then \
		echo "âœ“ Virtual environment already exists"; \
	else \
		echo "ðŸ“¦ Creating virtual environment..."; \
		uv venv --python 3.11 $(VENV_DIR); \
	fi
	@echo "ðŸ“¥ Installing base dependencies..."
	@uv pip install -r requirements.txt
	@echo "âœ… Setup complete!"
	@echo ""
	@echo "Activate environment:"
	@echo "  source $(VENV_DIR)/bin/activate"

run: setup
	@echo "ðŸš€ Starting Interactive Agent Playground..."
	@python interactive_agent.py

test: setup
	@echo "ðŸ§ª Running tests..."
	@python -m pytest tests/ -v

test-cov: setup
	@echo "ðŸ“Š Running tests with coverage..."
	@python -m pytest tests/ --cov=interactive_agent --cov-report=html
	@echo "Coverage report: htmlcov/index.html"

lint: setup
	@echo "ðŸ” Running linter..."
	@python -m ruff check interactive_agent.py

lint-fix: setup
	@echo "ðŸ”§ Auto-fixing linting issues..."
	@python -m ruff check interactive_agent.py --fix

format: setup
	@echo "ðŸŽ¨ Formatting code..."
	@python -m black interactive_agent.py

type-check: setup
	@echo "ðŸ”¬ Type checking..."
	@python -m mypy interactive_agent.py

check: lint type-check format
	@echo "âœ… All checks passed!"

install-dev: setup
	@echo "ðŸ”§ Installing development tools..."
	@uv pip install mypy black ruff
	@echo "âœ… Dev tools installed!"

install-ollama: setup
	@echo "ðŸ“¦ Installing Ollama support..."
	@uv pip install requests>=2.31.0
	@echo "âœ… Ollama support installed!"

install-all: setup install-dev install-ollama
	@echo "âœ… All dependencies installed!"

clean:
	@echo "ðŸ§¹ Cleaning up..."
	@rm -rf $(VENV_DIR)
	@rm -rf __pycache__ .pytest_cache .mypy_cache .ruff_cache
	@rm -rf htmlcov .coverage
	@find . -type d -name __pycache__ -exec rm -rf {} + 2>/dev/null || true
	@echo "âœ… Cleanup complete!"

clean-cache:
	@echo "ðŸ§¹ Cleaning cache files..."
	@rm -rf __pycache__ .pytest_cache .mypy_cache .ruff_cache
	@rm -rf htmlcov .coverage
	@echo "âœ… Cache cleanup complete!"

.DEFAULT_GOAL := help
